; PHP 7.4 FPM Configuration
; Basic settings
memory_limit = 512M
max_execution_time = 300
max_input_time = 300
max_input_vars = 5000
post_max_size = 64M
upload_max_filesize = 64M

; Only load non-core extensions that are actually available
; Note: Many extensions are built into PHP core and don't need to be loaded

; Zend extensions (must use zend_extension)
zend_extension=opcache

; OPcache settings
opcache.enable=1
opcache.memory_consumption=128
opcache.interned_strings_buffer=8
opcache.max_accelerated_files=4000
opcache.revalidate_freq=2
extension=pcre
extension=pdo
extension=phar
extension=posix
extension=session
extension=simplexml
extension=spl
extension=tokenizer
extension=xml
extension=xmlreader
extension=xmlwriter

; Database Extensions
extension=mysqli
extension=pdo_mysql
extension=pdo_sqlite
extension=sqlite3
extension=redis

; Compression Extensions
extension=zip
extension=zlib
extension=bz2

; Image & Graphics Extensions
extension=gd
extension=imagick
extension=exif

; Internationalization Extensions
extension=intl
extension=gettext
extension=iconv

; Math Extensions
extension=bcmath
extension=gmp

; String/Text Extensions
extension=ctype
extension=pcntl
extension=pcre

; Network Extensions
extension=sockets
extension=ftp

; Encryption/Security Extensions
extension=sodium
extension=openssl

; Performance Extensions
extension=opcache
extension=apcu

; Utility Extensions
extension=calendar
extension=shmop
extension=sysvmsg
extension=sysvsem
extension=sysvshm

; Web Service Extensions
extension=soap
extension=xmlrpc
extension=xsl

; Development Extensions
extension=xdebug

; Error reporting
display_errors = On
display_startup_errors = On
error_reporting = E_ALL
log_errors = On
error_log = /var/log/php/7.4/error.log

; Session configuration
session.save_handler = files
session.save_path = "/var/lib/php/sessions"
session.gc_probability = 1
session.gc_divisor = 1000
session.gc_maxlifetime = 1440
session.cookie_lifetime = 0
session.cookie_secure = 0
session.cookie_httponly = 1
session.use_strict_mode = 1

; Security
expose_php = Off
allow_url_fopen = On
allow_url_include = Off
auto_globals_jit = On

; Phar settings
phar.readonly = Off
phar.require_hash = Off

; OPcache settings
opcache.enable = 1
opcache.enable_cli = 0
opcache.memory_consumption = 256
opcache.interned_strings_buffer = 16
opcache.max_accelerated_files = 10000
opcache.revalidate_freq = 2
opcache.fast_shutdown = 1
opcache.save_comments = 1
opcache.load_comments = 1

; APCu settings
apc.enabled = 1
apc.shm_size = 64M
apc.ttl = 7200

; Date settings
date.timezone = "UTC"

; Redis session (optional)
; session.save_handler = redis
; session.save_path = "tcp://redis:6379"

; Xdebug settings (for development)
xdebug.mode = debug,coverage,profile
xdebug.start_with_request = trigger
xdebug.client_host = host.docker.internal
xdebug.client_port = 9003
xdebug.log = /var/log/php/7.4/xdebug.log
